<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ESP32 - Parameters</title>
    <style>
        /* Equivalent of Tailwind base styles and utility classes */

        /* Optional: Add a simple focus style not covered by default Tailwind setup */
        .input-focus:focus {
            border-color: #3b82f6; /* focus:border-blue-500 */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5); /* focus:ring-blue-500 */
        }
        .bg-gray-100 { background-color: #f3f4f6; }
        .container { width: 100%; margin-left: auto; margin-right: auto; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .p-8 { padding: 2rem; }
        .max-w-3xl { max-width: 48rem; } /* Equivalent to 48rem */
        .text-center { text-align: center; }
        .mb-8 { margin-bottom: 2rem; }
        .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
        .font-bold { font-weight: 700; }
        .text-gray-800 { color: #1f2937; }
        .text-gray-500 { color: #6b7280; }
        .mt-2 { margin-top: 0.5rem; }
        .bg-white { background-color: #ffffff; }
        .rounded-lg { border-radius: 0.5rem; }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .space-y-8 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(2rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(2rem * var(--tw-space-y-reverse)); }
        .space-y-6 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(1.5rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(1.5rem * var(--tw-space-y-reverse)); }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .font-semibold { font-weight: 600; }
        .text-blue-600 { color: #2563eb; }
        .mb-4 { margin-bottom: 1rem; }
        .text-gray-600 { color: #4b5563; }
        /* UPDATED/NEW SPACING RULES FOR BOXES (1.5rem) */
        .p-6 { padding: 1.5rem; } 
        .mb-6 { margin-bottom: 1.5rem; } 
        .bg-gray-50 { background-color: #f9fafb; }
        .space-y-6-channel > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(1.5rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(1.5rem * var(--tw-space-y-reverse)); } 
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .border-b { border-bottom-width: 1px; }
        .pb-2 { padding-bottom: 0.5rem; }
        .grid { display: grid; }
        .gap-6 { gap: 1.5rem; } 
        .md\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        .block { display: block; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .font-medium { font-weight: 500; }
        .text-gray-700 { color: #374151; }
        .mb-1 { margin-bottom: 0.25rem; }
        .w-full { width: 100%; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .border-gray-300 { border-color: #d1d5db; }
        .focus\:ring-blue-500:focus { --tw-ring-opacity: 1; --tw-ring-color: rgba(59, 130, 246, var(--tw-ring-opacity)); --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color); box-shadow: var(--tw-ring-shadow); }
        .focus\:border-blue-500:focus { border-color: #3b82f6; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .pt-2 { padding-top: 0.5rem; }
        .h-4 { height: 1rem; }
        .w-4 { width: 1rem; }
        .text-blue-600 { color: #2563eb; }
        .ml-2 { margin-left: 0.5rem; }

        /* Footer/Button Styles */
        .pt-4 { padding-top: 1rem; }
        .justify-between { justify-content: space-between; }
        .border-t { border-top-width: 1px; }
        .w-auto { width: auto; }
        .bg-gray-500 { background-color: #6b7280; }
        .hover\:bg-gray-600:hover { background-color: #4b5563; }
        .text-white { color: #ffffff; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .transition-colors { transition-property: background-color, border-color, color, fill, stroke; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .bg-green-500 { background-color: #10b981; }
        .hover\:bg-green-600:hover { background-color: #059669; }
        .border-gray-200 { border-color: #e5e7eb; }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-8 max-w-3xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800">Device Parameters</h1>
            <p class="text-gray-500 mt-2">Configure ADC, sampling, and channel settings.</p>
        </header>

        <main class="bg-white rounded-lg shadow-xl p-8 space-y-8">
            
            <form id="parameterForm" action="/save-parameters" class="space-y-6">

                <div>
                    <h2 class="text-2xl font-semibold text-blue-600 mb-4">Individual Channel Configuration (4 Channels)</h2>
                    <p class="text-gray-600">Set specific sampling and ADC parameters for each independent channel.</p>
                </div>

                <div class="p-6 border border-gray-200 rounded-lg mb-6 bg-gray-50 space-y-6-channel">
                    <h3 class="text-xl font-bold text-gray-800 border-b pb-2">Channel 1 Settings</h3>
                    <div class="grid md:grid-cols-4 gap-6">
                        <div>
                            <label for="ch1_name" class="block text-sm font-medium text-gray-700 mb-1">Channel Name</label>
                            <input type="text" id="ch1_name" name="ch1_name" value="Voltage_A" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 input-focus">
                        </div>
                        <div>
                            <label for="ch1_samplingRate" class="block text-sm font-medium text-gray-700 mb-1">Sampling Interval(ms)</label>
                            <input type="number" id="ch1_samplingRate" name="ch1_samplingRate" min="1" value="1000" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 input-focus">
                        </div>
                        <div>
                            <label for="ch1_resolution" class="block text-sm font-medium text-gray-700 mb-1">Resolution (Bits)</label>
                            <select id="ch1_resolution" name="ch1_resolution" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                <option value="9">9-bit</option>
                                <option value="10">10-bit</option>
                                <option value="11">11-bit</option>
                                <option value="12" selected>12-bit</option>
                            </select>
                        </div>
                        <!-- <div>
                            <label for="ch1_attn" class="block text-sm font-medium text-gray-700 mb-1">Attenuation</label>
                            <select id="ch1_attn" name="ch1_attn" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                <option value="0">0 dB</option>
                                <option value="1">2.5 dB</option>
                                <option value="2" selected>6 dB</option>
                                <option value="3">11 dB</option>
                            </select>
                        </div> -->
                    </div>
                    <div class="flex items-center pt-2">
                        <input id="ch1_enabled" name="ch1_enabled" type="checkbox" checked
                            class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
                        <label for="ch1_enabled" class="ml-2 font-medium text-gray-700 text-sm">Enable Channel 1</label>
                    </div>
                </div>

                <div class="p-6 border border-gray-200 rounded-lg mb-6 bg-gray-50 space-y-6-channel">
                    <h3 class="text-xl font-bold text-gray-800 border-b pb-2">Channel 2 Settings</h3>
                    <div class="grid md:grid-cols-4 gap-6">
                        <div>
                            <label for="ch2_name" class="block text-sm font-medium text-gray-700 mb-1">Channel Name</label>
                            <input type="text" id="ch2_name" name="ch2_name" value="Current_B" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 input-focus">
                        </div>
                        <div>
                            <label for="ch2_samplingRate" class="block text-sm font-medium text-gray-700 mb-1">Sampling Rate (Hz)</label>
                            <input type="number" id="ch2_samplingRate" name="ch2_samplingRate" min="1" value="500" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 input-focus">
                        </div>
                        <div>
                            <label for="ch2_resolution" class="block text-sm font-medium text-gray-700 mb-1">Resolution (Bits)</label>
                            <select id="ch2_resolution" name="ch2_resolution" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                <option value="9">9-bit</option>
                                <option value="10" selected>10-bit</option>
                                <option value="11">11-bit</option>
                                <option value="12">12-bit</option>
                            </select>
                        </div>
                        <!-- <div>
                            <label for="ch2_attn" class="block text-sm font-medium text-gray-700 mb-1">Attenuation</label>
                            <select id="ch2_attn" name="ch2_attn" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                <option value="0">0 dB</option>
                                <option value="1">2.5 dB</option>
                                <option value="2">6 dB</option>
                                <option value="3" selected>11 dB</option>
                            </select>
                        </div> -->
                    </div>
                    <div class="flex items-center pt-2">
                        <input id="ch2_enabled" name="ch2_enabled" type="checkbox" checked
                            class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
                        <label for="ch2_enabled" class="ml-2 font-medium text-gray-700 text-sm">Enable Channel 2</label>
                    </div>
                </div>
                
                <div class="p-6 border border-gray-200 rounded-lg mb-6 bg-gray-50 space-y-6-channel">
                    <h3 class="text-xl font-bold text-gray-800 border-b pb-2">Channel 3 Settings</h3>
                    <div class="grid md:grid-cols-4 gap-6">
                        <div>
                            <label for="ch3_name" class="block text-sm font-medium text-gray-700 mb-1">Channel Name</label>
                            <input type="text" id="ch3_name" name="ch3_name" value="Temperature_C" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 input-focus">
                        </div>
                         <div>
                            <label for="ch3_samplingRate" class="block text-sm font-medium text-gray-700 mb-1">Sampling Rate (Hz)</label>
                            <input type="number" id="ch3_samplingRate" name="ch3_samplingRate" min="1" value="10" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 input-focus">
                        </div>
                        <div>
                            <label for="ch3_resolution" class="block text-sm font-medium text-gray-700 mb-1">Resolution (Bits)</label>
                            <select id="ch3_resolution" name="ch3_resolution" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                <option value="9" selected>9-bit</option>
                                <option value="10">10-bit</option>
                                <option value="11">11-bit</option>
                                <option value="12">12-bit</option>
                            </select>
                        </div>
                        <!-- <div>
                            <label for="ch3_attn" class="block text-sm font-medium text-gray-700 mb-1">Attenuation</label>
                            <select id="ch3_attn" name="ch3_attn" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                <option value="0" selected>0 dB</option>
                                <option value="1">2.5 dB</option>
                                <option value="2">6 dB</option>
                                <option value="3">11 dB</option>
                            </select>
                        </div> -->
                    </div>
                    <div class="flex items-center pt-2">
                        <input id="ch3_enabled" name="ch3_enabled" type="checkbox" checked
                            class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
                        <label for="ch3_enabled" class="ml-2 font-medium text-gray-700 text-sm">Enable Channel 3</label>
                    </div>
                </div>

                <div class="p-6 border border-gray-200 rounded-lg mb-6 bg-gray-50 space-y-6-channel">
                    <h3 class="text-xl font-bold text-gray-800 border-b pb-2">Channel 4 Settings</h3>
                    <div class="grid md:grid-cols-4 gap-6">
                        <div>
                            <label for="ch4_name" class="block text-sm font-medium text-gray-700 mb-1">Channel Name</label>
                            <input type="text" id="ch4_name" name="ch4_name" value="Aux_D" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 input-focus">
                        </div>
                         <div>
                            <label for="ch4_samplingRate" class="block text-sm font-medium text-gray-700 mb-1">Sampling Rate (Hz)</label>
                            <input type="number" id="ch4_samplingRate" name="ch4_samplingRate" min="1" value="100" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 input-focus">
                        </div>
                        <div>
                            <label for="ch4_resolution" class="block text-sm font-medium text-gray-700 mb-1">Resolution (Bits)</label>
                            <select id="ch4_resolution" name="ch4_resolution" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                <option value="9">9-bit</option>
                                <option value="10">10-bit</option>
                                <option value="11" selected>11-bit</option>
                                <option value="12">12-bit</option>
                            </select>
                        </div>
                        <!-- <div>
                            <label for="ch4_attn" class="block text-sm font-medium text-gray-700 mb-1">Attenuation</label>
                            <select id="ch4_attn" name="ch4_attn" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                <option value="0">0 dB</option>
                                <option value="1" selected>2.5 dB</option>
                                <option value="2">6 dB</option>
                                <option value="3">11 dB</option>
                            </select>
                        </div> -->
                    </div>
                    <div class="flex items-center pt-2">
                        <input id="ch4_enabled" name="ch4_enabled" type="checkbox"
                            class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
                        <label for="ch4_enabled" class="ml-2 font-medium text-gray-700 text-sm">Enable Channel 4</label>
                    </div>
                </div>

                <div class="pt-4 flex justify-between items-center border-t">
                    <a href="/data_page.html" class="w-auto bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-colors flex items-center">
                        &larr; Back to Main
                    </a>
                    <button type="submit" onclick="submitJsonForm()" class="w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-colors flex items-center">
                        Save Parameters &rarr;
                    </button>
                </div>
            </form>

        </main>
    </div>

    <script>
        function submitJsonForm() {
            const form = document.getElementById('parameterForm');
            // Prevent standard form submission
            event.preventDefault(); 

            const data = {
                channels: [] 
            };
            
            // Collect data for Channels 1 through 4
            for (let i = 1; i <= 4; i++) {
                const name = document.getElementById(`ch${i}_name`).value;
                // Parse numbers to ensure they are sent as JSON numbers, not strings
                const samplingRate = parseInt(document.getElementById(`ch${i}_samplingRate`).value);
                const resolution = parseInt(document.getElementById(`ch${i}_resolution`).value);
                const attenuation = parseInt(document.getElementById(`ch${i}_attn`).value);
                // The .checked property ensures we send a boolean true/false
                const enabled = document.getElementById(`ch${i}_enabled`).checked; 

                data.channels.push({
                    // Use the channel number as the ID (1, 2, 3, 4)
                    id: i, 
                    name: name,
                    enabled: enabled,
                    samplingRate: samplingRate,
                    resolution: resolution,
                    attenuation: attenuation
                });
            }

            // Convert the JavaScript object to a JSON string for the ESP32
            const jsonPayload = JSON.stringify(data);

            // Use the fetch API to send the JSON data
            fetch(form.action, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: jsonPayload
            })
            .then(response => {
                if (response.ok) {
                    alert('Parameters saved successfully! The device may restart to apply logging changes.');
                } else {
                    alert('Error saving parameters. Server returned: ' + response.status);
                }
            })
            .catch(error => {
                console.error('Fetch error:', error);
                alert('A network error occurred while submitting data. Is the ESP32 access point running?');
            });
        }
    </script>

</body>
</html>
